services:
  # Eureka Server
  eureka-server:
    image: eureka:1.0
    build:
      context: .
      dockerfile: eureka/Dockerfile
    container_name: eureka-server
    ports:
      - "8761:8761"
    networks:
      - app-network
    environment:
      - JAVA_OPTS=-Xms256m -Xmx512m
      - EUREKA_SERVER_PORT=8761
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8761"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Gateway Service
  gateway:
    image: gateway:1.0
    build:
      context: .
      dockerfile: gateway/Dockerfile
    container_name: gateway-service
    ports:
      - "8080:8080"
    networks:
      - app-network
    depends_on:
      - eureka-server
    environment:
      - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://eureka-server:8761/eureka
      - JAVA_OPTS=-Xms256m -Xmx512m

  # Auth Service
  auth-service:
    image: auth:1.0
    build:
      context: .
      dockerfile: auth/Dockerfile
    container_name: auth-service
    ports:
      - "8081:8081"
    networks:
      - app-network
    depends_on:
      - eureka-server
    environment:
      - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://eureka-server:8761/eureka
      - JAVA_OPTS=-Xms256m -Xmx512m

  # Blog Service
  blog-service:
    image: blog:1.0
    build:
      context: .
      dockerfile: blog/Dockerfile
    container_name: blog-service
    ports:
      - "8082:8082"
    networks:
      - app-network
    depends_on:
      - eureka-server
    environment:
      - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://eureka-server:8761/eureka
      - JAVA_OPTS=-Xms256m -Xmx512m

networks:
  app-network:
    driver: bridge
